---
title: Tvorba webových stránok v jazyku Python
layout: slide
duration: 180
theme: night
bitly: 2HSPYkr
todo:
- swagger OpenAPI
---

<section data-markdown>
### Ako zvládnuť webinár

* pomenuj svojho avatara
    * napr. dvojkliknutím na svoje meno vpravo hore
* nevysielaj obraz, pokiaľ nemusíš
    * ušetríš linku ostatným ;)
* vypni mikrofón, keď nehovoríš
    * ušetríš linku ostatným ;)
    * minimalizuješ vzruchy
* pýtaj sa, ak máš nejasnosti
    * stlač medzerník a drž ho, kým rozprávaš (ako na vysielačke) alebo použi chat
</section>


<section data-markdown id="introduction">
## {{ page.title }}

mirek@cnl.sk / [**Namakaný deň**](https://namakanyden.sk)
</section>


<section id="newsletter">
    <h2>Newsletter</h2>

    <!-- Begin Mailchimp Signup Form -->
    <link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">

    <div id="mc_embed_signup">
        <form action="https://namakanyden.us19.list-manage.com/subscribe/post?u=2be0bc7fd4b16338d9a99b465&amp;id=41a1b70536"
              method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>

            <div id="mc_embed_signup_scroll">
                <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="Prihláste sa na odoberanie noviniek emailom" required>
                <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_2be0bc7fd4b16338d9a99b465_41a1b70536" tabindex="-1" value=""></div>
                <div>
                    <input type="submit" value="Prihlásiť" name="subscribe" id="mc-embedded-subscribe" class="button">
                </div>
            </div>
        </form>
    </div>
    <!--End mc_embed_signup-->
</section>


<section data-markdown id="fastapi">
[![FastAPI](images/logo.fastapi.png)](https://fastapi.tiangolo.com)

FastAPI framework, high performance, easy to learn, fast to code, ready for production
</section>


<section data-markdown id="features">
## Features

[Fast](https://www.techempower.com/benchmarks/#section=test&runid=7464e520-0dc2-473d-bd34-dbdfd7e85911&hw=ph&test=query&l=z8kflr-v&a=2), 
Fast to code, Fewer bugs, Intuitive, Easy, Short, Robust, Standards-based
</section>


<section data-markdown id="sebastian-ramirez">
![Sebastian Ramirez](images/sebastian.ramirez.jpg)]
## [Sebastian Ramirez](https://github.com/tiangolo)
</section>


<section id="talk-python-to-me">
    <iframe width="100%" height="166" scrolling="no" frameborder="no" allow="autoplay" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/904573510&color=%23ff5500&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true"></iframe><div style="font-size: 10px; color: #cccccc;line-break: anywhere;word-break: normal;overflow: hidden;white-space: nowrap;text-overflow: ellipsis; font-family: Interstate,Lucida Grande,Lucida Sans Unicode,Lucida Sans,Garuda,Verdana,Tahoma,sans-serif;font-weight: 100;"><a href="https://soundcloud.com/talkpython" title="Talk Python To Me Podcast" target="_blank" style="color: #cccccc; text-decoration: none;">Talk Python To Me Podcast</a> · <a href="https://soundcloud.com/talkpython/modern-and-fast-apis-with-fastapi" title="Modern and fast APIs with FastAPI" target="_blank" style="color: #cccccc; text-decoration: none;">Modern and fast APIs with FastAPI</a></div>
</section>


<section data-markdown id="the-plan">
## The Plan

### One Time

0. installation
1. introduction
2. web templates

### Next Time

3. REST API 
4. Open API (Swagger)
</section>


<section data-markdown id="instalation">
## #1 Installation

```bash
$ pip install fastapi uvicorn
```
</section>


<!--<section>-->
    <!--<div id="termynal" data-termynal>-->
        <!--<span data-ty="input">pip install spacy</span>-->
        <!--<span data-ty="progress"></span>-->
        <!--<span data-ty>Successfully installed spacy</span>-->
        <!--<span data-ty></span>-->
        <!--<span data-ty="input">python -m spacy download en</span>-->
        <!--<span data-ty="progress"></span>-->
        <!--<span data-ty>Installed model 'en'</span>-->
        <!--<span data-ty></span>-->
        <!--<span data-ty="input">python</span>-->
        <!--<span data-ty="input" data-ty-prompt=">>>">import spacy</span>-->
        <!--<span data-ty="input" data-ty-prompt=">>>">nlp = spacy.load('en')</span>-->
        <!--<span data-ty="input" data-ty-prompt=">>>">doc = nlp(u'Hello world')</span>-->
        <!--<span data-ty="input" data-ty-prompt=">>>">print([(w.text, w.pos_) for w in doc])</span>-->
        <!--<span data-ty>[('Hello', 'INTJ'), ('world', 'NOUN')]</span>-->
    <!--</div>-->

<!--</section>-->


<section data-markdown id="introduction">
## #2 Introduction
</section>


<section data-markdown id="hello-world-code">
## Code...

```python
# file: hello.py
from fastapi import FastAPI
app = FastAPI()

@app.get("/")
def hello():
    return {"Hello": "World"}
```
</section>


<section data-markdown id="hello-world-run">
## ...and Run!

```bash
$ uvicorn hello:app --reload
```
</section>



<section data-markdown id="hello-world-all-in-one">
## Run from Code

```python
# file: hello2.py
from fastapi import FastAPI
import uvicorn
app = FastAPI()

@app.get("/")
def hello():
    return {"Hello": "World"}

if __name__ == "__main__":
    uvicorn.run('hello:app', 
                host="0.0.0.0", 
                port=5000,  # default port is 8000
                reload=True)
```
</section>


<section id="fastapi-vs-flask">
    <h2><a href="https://fastapi.tiangolo.com#create-it">FastAPI</a> vs <a href="https://flask.palletsprojects.com/en/1.1.x/quickstart/#a-minimal-application">Flask</a></h2>

<div style="display: flex;">
  <div style="flex: 50%;">
      <pre>
      <code class="lang-python hljs">
from fastapi import FastAPI
app = FastAPI()

@app.get("/")
def hello():
    return {"Hello": "World"}
      </code>
      </pre>
  </div>
  <div style="flex: 50%;">
      <pre>
      <code class="lang-python hljs">
from flask import Flask
app = Flask(__name__)

@app.route('/')
def hello():
    return 'Hello, World!'
      </code>
      </pre>
  </div>
</div>
</section>


<section data-markdown id="key-difference">
## Key Difference...

...API First Approach
</section>


<section data-markdown id="curl">
```bash
$ curl -v http://localhost:5000
* Connected to localhost (127.0.0.1) port 5000 
> GET / HTTP/1.1
> Host: localhost:5000
> User-Agent: curl/7.71.1
> Accept: */*
> 
< HTTP/1.1 200 OK
< date: Wed, 04 Nov 2020 09:46:48 GMT
< server: uvicorn
< content-length: 17
< content-type: application/json
< 
{"Hello":"World"}
```
</section>


<section data-markdown id="use-case">
## The Use Case

simple sensor dashboard
</section>


<section data-markdown id="components-of-url" data-background="#fff">
![Components of URL](images/url.format.explained.png)

Notes:
* https://bind.media/cro/how-to-setup-hotjar-basic-account/
</section>


<section data-markdown id="web-templates">
## #3 Web Templates

* you can use any template engine you want
* we will use [Jinja2](https://jinja.palletsprojects.com/en/2.11.x/)
    * "native" support in Flask
    * very popular
</section>


<section data-markdown id="jinja2" data-background="#fff">
[![Jinja2 Logo](images/logo.jinja2.png)](https://jinja.palletsprojects.com/en/2.11.x/)
</section>


<section data-markdown id="jinja2-installation">
## Installing Jinja2

```bash
$ pip install jinja2
```
</section>


<section data-markdown id="jinja2-introduction">
## Jinja2 Introduction

```python
from jinja2 import Template

template = Template('Hello {% raw %}{{ name }}{% endraw %}!')
print(template.render(name='John Doe'))
# 'Hello John Doe!'
```
</section>


<section data-markdown id="mtv-logo" data-background="#000">
![MTV](images/logo.mtv.jpg)
</section>


<section data-markdown id="mtv">
## Model Template View

web version of MVC
</section>


<section data-markdown id="jinja-with-fastapi">
## Jinja2 with FastAPI

```python
# file: dashboard.start.py
from fastapi import FastAPI, Request
from fastapi.responses import HTMLResponse
from fastapi.templating import Jinja2Templates

app = FastAPI()

templates = Jinja2Templates(directory="templates")

@app.get("/dashboard", response_class=HTMLResponse)
def view_dashboard(request: Request):
    return templates.TemplateResponse(
        "dashboard.html",
        {"request": request, "title": "My Dashboard"}
    )
```
</section>


<section data-markdown id="bootstrap" data-background="#573B7D">
[![Bootstrap](https://www.fullstackpython.com/img/logos/bootstrap.png)](https://getbootstrap.com)
</section>


<section data-markdown>
## Getting the Data from JSON File

```python
import json

@app.get("/dashboard", response_class=HTMLResponse)
async def view_dashboard(request: Request):
    data = json.load(open('data.json'))
    return templates.TemplateResponse(
        "dashboard.html",
        {
            "request": request, 
            "title": "Magic Dashboard!", 
            "temperature": data['temperature'], 
            "timestamp": data['timestamp']
        }
    )
```
</section>


<section data-markdown>
## Rendering Form

```python
@app.get("/form", response_class=HTMLResponse)
async def view_form(request: Request):
    return templates.TemplateResponse(
        "form.html", 
        {"request": request}
    )
```
</section>


<section data-markdown>
## Processing Form Data

```python
# imports!

@app.post("/form")
async def process_form(request: Request, 
                       temperature: float = Form(...)):
    now = datetime.now()
    data = {
        'temperature': str(temperature), 
        'timestamp': now.strftime("%d.%m.%Y %H:%M:%S")
    }
    with  open('data.json', 'w+') as file:
        json.dump(data, file)

    return RedirectResponse(url='/dashboard', 
                            status_code=HTTP_303_SEE_OTHER)
```
</section>


<section data-markdown id="rest-api">
## REST API

* one endpoint for two HTTP methods
    * `GET /api/temp/` - get curren temperature
    * `POST /api/temp/` - add new measurement
</section>


<section data-markdown id="get-example">
## `GET /api/temp`

```python
@app.get('/api/temp')
def get_latest_value():
    file = open('data.json')
    data = json.load(file)
    return data
```
</section>


<section data-markdown id="documentation">
## Documentation

* builtin support for
    * [Swagger/OpenAPI](https://github.com/swagger-api/swagger-ui)
    * [ReDoc](https://github.com/Redocly/redoc)
* accessing the doc on `http://URL/docs`
</section>


<section data-markdown id="pydantic">
## [Pydantic](https://pydantic-docs.helpmanual.io)

Data validation and settings management using python type annotations.
</section>


<section data-markdown id="pydantic-model">
## `Payload` Model

```python
from datetime import datetime
from pydantic import BaseModel

class Payload(BaseModel):
    temperature: float
    created: datetime = datetime.now().isoformat()
```
</section>


<section data-markdown id="post-example">
## `POST /api/temp`

```python
@app.post('/api/temp', status_code = 201)
def add_new_value(data: Payload):
    with open('data.json', 'w+') as file:
        json.dump(data.dict(), file)
    return data
```
</section>


<section data-markdown id="testing">
## Testing/Using

```python
import requests

url = 'http://localhost:8000/api/temp'
r = requests.post(url, json={'temperature': -3})
print(r.status_code)
# 201 Created
```
</section>


<section data-markdown id="questions">
## Questions?
</section>


<section data-markdown id="links">
## Links

* [FastAPI Homepage](https://fastapi.tiangolo.com)
* source codes - [hello.py](src/hello.py), [dashboard.1.py](src/dashboard.1.py), [dashboard.2.py](src/dashboard.2.py)
* templates - [dashboard.html](templates/dashboard.html), [form.html](templates/form.html)
* code on [codeshare](https://codeshare.io/a3LwOL)
</section>


<section data-markdown id="qr-code">
![qr code](https://api.qrserver.com/v1/create-qr-code/?data=https://bit.ly/{{ page.bitly }}&size=300x300)

(**https://bit.ly/{{ page.bitly }}**)
</section>

<script src="js/termynal.js" data-termynal-container="#termynal"></script>

<!-- mailchimp -->
<script id="mcjs">!function(c,h,i,m,p){m=c.createElement(h),p=c.getElementsByTagName(h)[0],m.async=1,m.src=i,p.parentNode.insertBefore(m,p)}(document,"script","https://chimpstatic.com/mcjs-connected/js/users/2be0bc7fd4b16338d9a99b465/304ea24ea1a61ae8158844207.js");</script>
